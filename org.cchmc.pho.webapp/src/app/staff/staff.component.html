<div id="staffcomponent" class="content-main">
    <div fxLayout="row" class="staff-header">
        <div fxLayout="column" class="header-filter filter-btn">

            <button mat-button (click)="applySelectedFilter('position','Physician')">Physicians</button>

        </div>
        <div fxLayout="column" class="header-filter filter-btn">
            <button mat-button (click)="applySelectedFilter('position','Medical Assistant')">Clinical Staff</button>
        </div>
        <div fxLayout="column" class="header-filter filter-btn">
            <button mat-button (click)="applySelectedFilter('position','Support Staff')">Support Staff</button>
        </div>
        <div fxLayout="column" class="header-filter">
            <mat-form-field>
                <mat-label>Responsibilities</mat-label>
                <mat-select [formControl]="responsibilityFilter"
                    (selectionChange)="applySelectedFilter('responsibilities','')">
                    <mat-option></mat-option>
                    <mat-option *ngFor="let responsibility of responsibilities" [value]="responsibility.name">

                        {{responsibility.name}}

                    </mat-option>

                </mat-select>
            </mat-form-field>
        </div>
        <div fxLayout="column" class="header-filter search-input" fxFlex fxLayoutAlign="center end">
            <mat-form-field>
                <input matInput [formControl]="staffNameFilter" (keyup)="applySelectedFilter('StaffName','')"
                    placeholder="search staff by name">
                    <button mat-button matSuffix mat-icon-button aria-label="Search">
                        <mat-icon>search</mat-icon>
                      </button>
            </mat-form-field>
        </div>
    </div>
    <div>
    </div>
    <mat-table #table [dataSource]="dataSourceStaff" matSort (matSortChange)="onSortData($event)"
        class="mat-elevation-z8" id="staff" multiTemplateDataRows>

        <!--- Note that these columns can be defined in any order.
          The actual rendered columns are set as a property on the row definition" -->

        <!-- DropDown Column -->
        <ng-container matColumnDef="arrow">
            <mat-header-cell *matHeaderCellDef></mat-header-cell>
            <mat-cell *matCellDef="let element">
                <i class="material-icons rotate-icon">
                    keyboard_arrow_right
                </i>
            </mat-cell>
        </ng-container>

        <!-- Name Column -->
        <ng-container matColumnDef="name">
            <mat-header-cell *matHeaderCellDef mat-sort-header="StaffName"> name </mat-header-cell>
            <mat-cell *matCellDef="let element"> {{element.lastName}} {{element.firstName}} </mat-cell>
        </ng-container>


        <!-- email Column -->
        <ng-container matColumnDef="email">
            <mat-header-cell *matHeaderCellDef> email </mat-header-cell>
            <mat-cell *matCellDef="let element" matTooltip={{element.email}}>
                <!-- {{element.email}}  -->
                <a href="mailto:{{element.email}}">
                    <i class="material-icons icons-white-mail">
                        email
                    </i>
                </a>


            </mat-cell>
        </ng-container>

        <!-- phone Column -->
        <ng-container matColumnDef="phone">
            <mat-header-cell *matHeaderCellDef> phone </mat-header-cell>
            <mat-cell *matCellDef="let element"> {{element.phone}} </mat-cell>
        </ng-container>

        <!-- positionId Column -->
        <ng-container matColumnDef="position">
            <mat-header-cell *matHeaderCellDef mat-sort-header="PositionName"> position </mat-header-cell>
            <mat-cell *matCellDef="let element"> {{element.position?.name}} </mat-cell>
        </ng-container>

        <!-- credentialId Column -->
        <ng-container matColumnDef="credentials">
            <mat-header-cell *matHeaderCellDef mat-sort-header="CredentialName"> credential </mat-header-cell>
            <mat-cell *matCellDef="let element"> {{element.credentials?.name}} </mat-cell>
        </ng-container>

        <!-- isRegistry Column -->
        <ng-container matColumnDef="isRegistry">
            <mat-header-cell *matHeaderCellDef mat-sort-header="IsRegistry"> Registry </mat-header-cell>
            <mat-cell *matCellDef="let element">
                <ng-container *ngIf="element.isRegistry; else RegistryNo">
                    Yes
                </ng-container>
                <ng-template #RegistryNo>
                    No
                </ng-template>

            </mat-cell>
        </ng-container>



        <!-- responsibilities Column -->
        <ng-container matColumnDef="responsibilities">
            <mat-header-cell *matHeaderCellDef> responsibilities </mat-header-cell>
            <mat-cell *matCellDef="let element">
                <div fxLayout="row wrap" fxLayoutGap="14px">
                    <div *ngFor="let responsibility of element.responsibilities?.split(',')" fxLayout="column"
                        fxflex="33%" class="responsibility-container">
                        <div *ngIf="responsibility" class="responsibility-chip" [style.margin-bottom] = "element.responsibilities?.split(',').length > 2 ? '5px' : '0px'"
                        [style.margin-top] = "element.responsibilities?.split(',').length > 2 ? '5px' : '0px'">
                            {{ responsibility }}
                        </div>
                    </div>
                </div>
            </mat-cell>
        </ng-container>

        <!-- Hidden Columns===============================================================-->
        <!-- id Column -->
        <ng-container matColumnDef="id">
            <mat-header-cell *matHeaderCellDef> id </mat-header-cell>
            <mat-cell *matCellDef="let element"> {{element.id}} </mat-cell>
        </ng-container>

        <!-- firstName Column -->
        <ng-container matColumnDef="firstName">
            <mat-header-cell *matHeaderCellDef> firstName </mat-header-cell>
            <mat-cell *matCellDef="let element"> {{element.firstName}} </mat-cell>
        </ng-container>

        <!-- lastName Column -->
        <ng-container matColumnDef="lastName">
            <mat-header-cell *matHeaderCellDef> lastName </mat-header-cell>
            <mat-cell *matCellDef="let element"> {{element.lastName}} </mat-cell>
        </ng-container>

        <!-- Expanded Content Column - The detail row is made up of this one column that spans across all columns -->
        <ng-container matColumnDef="expandedDetail" #expansionRow>

            <mat-cell *matCellDef="let element" [attr.colspan]="displayedColumns.length" [@detailExpand]="element == expandedElement ? 'expanded' : 'collapsed'">
                <div id="staff-details" fxFlex>
                <div fxLayout="row" class="detail-heading" fxLayoutAlign="flex-start center">
                    DEMOGRAPHICS
                </div>
                <form [formGroup]="StaffDetailsForm">
                    <div class="staff-element-detail">
                            
                            <div fxLayout="row" class="form-row" fxLayoutGap="34px">
                                <div fxLayout="column" fxFlex class="input-w-icon">
                                    <mat-form-field>
                                        <mat-label>Email</mat-label>
                                        <input matInput formControlName="email" name="email">
                                        <mat-icon matPrefix>
                                            email
                                            </mat-icon>
                                        <ng-container
                                            *ngIf="(StaffDetailsForm.get('email').touched || StaffDetailsForm.get('email').dirty) && StaffDetailsForm.get('email').errors">
                                            <mat-error *ngIf="StaffDetailsForm.get('email').errors.required">
                                                Email address is required
                                            </mat-error>
                                            <mat-error *ngIf="StaffDetailsForm.get('email').errors.email">
                                                Enter a valid email address
                                            </mat-error>
    
                                        </ng-container>
                                    </mat-form-field>
                                  </div>

                                  <div fxLayout="column" fxFlex class="input-w-icon">
                                    <mat-form-field>
                                        <mat-label>Phone </mat-label>
                                        <input matInput formControlName="phone">
                                        <mat-icon matPrefix>phone</mat-icon>
                                    </mat-form-field>
                                    <ng-container
                                        *ngIf="(StaffDetailsForm.get('phone').touched || StaffDetailsForm.get('phone').dirty) && (StaffDetailsForm.get('phone').errors)">
                                        <mat-error *ngIf="StaffDetailsForm.get('phone').errors.required">
                                            phone number is required
                                        </mat-error>
                                    </ng-container>
                                </div>
                                
                                  <div fxLayout="column" fxFlex>
                                    <mat-form-field>
                                        <mat-label>NPI</mat-label>
                                        <input matInput formControlName="npi">
                                        <ng-container
                                            *ngIf="(StaffDetailsForm.get('npi').touched || StaffDetailsForm.get('npi').dirty) && (StaffDetailsForm.get('npi').errors)">
                                            <mat-error *ngIf="StaffDetailsForm.get('npi').errors.required">
                                                NPI is required
                                            </mat-error>
                                        </ng-container>
                                    </mat-form-field>
                                  </div>
                            </div>
                            <div fxLayout="row" fxLayoutGap="34px">
                                <div fxLayout="column" fxFlex class="input-w-icon date-picker-input">
                                    <mat-form-field class="multi-select-override" floatLabel="always">
                                        <mat-label>START DATE</mat-label>
                                        <input matInput placeholder="MM/DD/YYYY" formControlName="startDate"
                                            [matDatepicker]="picker">
                                        <mat-datepicker-toggle matPrefix [for]="picker">
                                            <mat-icon matDatepickerToggleIcon>
                                                calendar_today
                                            </mat-icon>
                                        </mat-datepicker-toggle>
                                        <mat-datepicker #picker></mat-datepicker>
    
                                        <mat-error *ngIf="StaffDetailsForm.get('startDate').hasError('required')">
                                            startDate is required
                                        </mat-error>
    
                                    </mat-form-field>
                                </div>
                                <div fxLayout="column" fxFlex>
                                    <mat-form-field class="multi-select-override">
                                        <mat-label>ROLE</mat-label>
                                        <mat-select formControlName="positionId">
                                            <mat-option *ngFor="let position of positions" [value]="position.id">
                                                {{position.name}}
                                            </mat-option>
                                        </mat-select>
                                        <ng-container
                                            *ngIf="(StaffDetailsForm.get('positionId').touched || StaffDetailsForm.get('positionId').dirty) && (StaffDetailsForm.get('positionId').errors)">
                                            <mat-error *ngIf="StaffDetailsForm.get('positionId').errors.required">
                                                Role is required
                                            </mat-error>
                                        </ng-container>
    
                                    </mat-form-field>
                                </div>
                               
                                <div fxLayout="column" fxFlex>
                                    <mat-form-field class="multi-select-override">
                                        <mat-label>CREDENTIALS</mat-label>
                                        <mat-select formControlName="credentialId">
                                            <mat-option *ngFor="let credential of credentials" [value]="credential.id">
                                                {{credential.name}}
                                            </mat-option>
    
                                        </mat-select>
                                        <ng-container
                                            *ngIf="(StaffDetailsForm.get('credentialId').touched || StaffDetailsForm.get('credentialId').dirty) && (StaffDetailsForm.get('credentialId').errors)">
                                            <mat-error *ngIf="StaffDetailsForm.get('credentialId').errors.required">
                                                credentials are required
                                            </mat-error>
                                        </ng-container>
                                    </mat-form-field>
                                </div>

                               
                                
                            </div>
                            <div fxLayout="row" class="check-row" fxLayoutGap="34px">
                                <div fxLayout="column">
                                    <div fxLayout="row" class="check-subrow"><label>Responsibilities</label></div>
                                    <div fxLayout="row" fxLayoutAlign="space-between center" fxLayoutGap="34px" class="check-subrow">
                                        <div fxLayout="column">
                                            <mat-checkbox formControlName="isQPLLeader">QI Lead Doc</mat-checkbox>
                                        </div>
                                        <div fxLayout="column">
                                            <mat-checkbox formControlName="isPracticeManager">Practice Manager

                                            </mat-checkbox>
                                        </div>
                                    </div>
                                        <div fxLayout="row" fxLayoutAlign="space-between center" fxLayoutGap="34px" class="check-subrow">
                                        <div fxLayout="column">
                                            <mat-checkbox formControlName="isQITeam">QI Team</mat-checkbox>
                                        </div>
                                        <div fxLayout="column">
                                            <mat-checkbox formControlName="isInterventionContact">Intervention Contact
                                            </mat-checkbox>
                                        </div>
                                    </div>
                                </div>
                                <div fxLayout="column">
                                    <div fxLayout="row" class="check-subrow"><label>Board Membership</label></div>
                                    <div fxLayout="row" fxLayoutAlign="space-around center" fxLayoutGap="34px" class="check-subrow">
                                        <mat-checkbox formControlName="isRVPIBoard">RVPI Board</mat-checkbox>
                                        <mat-checkbox formControlName="isOVPCABoard">OVPCA Board</mat-checkbox>
                                        <mat-checkbox formControlName="isPHOBoard">PHO Board</mat-checkbox>
                                    </div>
                                </div>

                            </div>
                            <div fxLayout="row" fxLayoutAlign="end end">
                                <button *ngIf="isUserAdmin" mat-flat-button color="accent">ADMIN CHANGE</button>
                                <button mat-flat-button color="accent" (click)="updateStaff()">SAVE</button>
                            </div>
                        

                    </div>
                </form>
            </div>
            </mat-cell>

        </ng-container>

        <mat-header-row *matHeaderRowDef="displayedColumns"></mat-header-row>
        <mat-row *matRowDef="let element; columns: displayedColumns;" class="staff-element-row"
            [class.staff-expanded-row]="expandedElement === element" (click)="getStaffDetails(element.id)"
            (click)="expandedElement=expandedElement===element ? null : element">
        </mat-row>

        <tr mat-row *matRowDef="let row; columns: ['expandedDetail']" class="staff-detail-row"></tr>

    </mat-table>
</div>

<!-- For Add Update User -->
<!-- <div fxLayout="column" fxFlex="50%">
    <div fxLayout="row" fxLayoutAlign="flex-start center">ADD / UPDATE PORTAL INFO</div>
    <div fxLayout="row" fxLayoutAlign="space-around center">
        <mat-form-field>
            <mat-label>USER NAME</mat-label>
            <input matInput [value]="">
        </mat-form-field>
        <mat-form-field>
            <mat-label>PASSWORD</mat-label>
            <input matInput [value]="">
        </mat-form-field>
        <mat-form-field>
            <mat-label>CONFIRM PW</mat-label>
            <input matInput [value]="">
        </mat-form-field>
        <mat-button-toggle-group name="fontStyle" aria-label="Font Style">
            <mat-button-toggle value="bold">Yes</mat-button-toggle>
            <mat-button-toggle value="italic">No</mat-button-toggle>
        </mat-button-toggle-group>
    </div>
    <div fxLayout="row">

        <mat-checkbox>Practice Member</mat-checkbox>
        <mat-checkbox>Practice Admin</mat-checkbox>
        <mat-checkbox>PHO Member</mat-checkbox>
        <mat-checkbox>PHO Admin</mat-checkbox>

    </div>
    <div fxLayout="row">
        <button mat-flat-button color="accent">SAVE</button>
    </div>
</div> -->