<div class="content-main">
  <div fxLayout="row" class="patients-header">
    <div fxLayout="column" class="header-filter">
      <mat-form-field>
        <mat-label>PCP</mat-label>
        <mat-select [(ngModel)]="pcP_StaffID"
          (selectionChange)="applySelectedFilter('pcP_StaffID', pcP_StaffID ? pcP_StaffID: '')">
          <mat-option *ngFor="let pcp of patients" [value]="pcp.pcP_StaffID">
            {{pcp.pcP_StaffID}}
          </mat-option>
        </mat-select>
      </mat-form-field>
    </div>
    <div fxLayout="column" class="header-filter">
      <mat-form-field>
        <mat-label>Population Slices</mat-label>
        <mat-select [(ngModel)]="pcP_StaffID"
          (selectionChange)="applySelectedFilter('pcP_StaffID', pcP_StaffID ? pcP_StaffID: '')">
          <mat-option *ngFor="let pcp of patients" [value]="pcp.pcP_StaffID">
            {{pcp.pcP_StaffID}}
          </mat-option>
        </mat-select>
      </mat-form-field>
    </div>
    <div fxLayout="column" class="header-filter">
      <mat-form-field>
        <mat-label>Conditions</mat-label>
        <mat-select [(ngModel)]="conditions"
          (selectionChange)="applySelectedFilter('conditions', conditions ? conditions: '')" multiple>
          <mat-option *ngFor="let condition of patients" [value]="condition.conditions.name">
            {{condition.conditions.name}}
          </mat-option>
        </mat-select>
      </mat-form-field>
    </div>
  </div>

  <table mat-table matSort [dataSource]="dataSource" id="patients">

    <!-- DropDown Column -->
    <ng-container matColumnDef="arrow">
      <th mat-header-cell *matHeaderCellDef mat-sort-header></th>
      <td mat-cell *matCellDef="let element">
        <i class="material-icons rotate-icon">
          keyboard_arrow_right
        </i>
      </td>
    </ng-container>

    <!-- Name Column -->
    <ng-container matColumnDef="name">
      <th mat-header-cell *matHeaderCellDef mat-sort-header> Name </th>
      <td mat-cell *matCellDef="let element"
        [ngStyle]="{'color': (element.potentiallyActiveStatus ? '#f0673c' : '#4A4A4A') }">
        {{element.lastName | titlecase}}, {{element.firstName | titlecase}} </td>
    </ng-container>

    <!-- DOB Column -->
    <ng-container matColumnDef="dob">
      <th mat-header-cell *matHeaderCellDef mat-sort-header> DOB </th>
      <td mat-cell *matCellDef="let element"> {{element.dob | date:'MM/dd/yyyy'}} </td>
    </ng-container>

    <!-- Last ED Visit Column -->
    <ng-container matColumnDef="lastEDVisit">
      <th mat-header-cell *matHeaderCellDef mat-sort-header> Last ED Visit </th>
      <td mat-cell *matCellDef="let element"> {{element.lastEDVisit | date:'MM/dd/yyyy'}} </td>
    </ng-container>

    <!-- Chronic Column -->
    <ng-container matColumnDef="chronic">
      <th mat-header-cell *matHeaderCellDef> Chronic
        <mat-checkbox class="table-header-checkbox" [(ngModel)]="chronic"
          (change)="applySelectedFilter('chronic', chronic ? 'true': '')"></mat-checkbox>
      </th>
      <td mat-cell *matCellDef="let element">
        <ng-container *ngIf="element.chronic; else elseNo">
          Yes
        </ng-container>
        <ng-template #elseNo>
          No
        </ng-template>
      </td>
    </ng-container>

    <!-- Watch List Column -->
    <ng-container matColumnDef="watchFlag">
      <th mat-header-cell *matHeaderCellDef> Watch List
        <mat-checkbox class="table-header-checkbox" [(ngModel)]="watchFlag"
          (change)="applySelectedFilter('watchFlag', watchFlag ? 'true': '')"></mat-checkbox>
      </th>
      <td mat-cell *matCellDef="let element">
        <ng-container *ngIf="element.watchFlag; else elseNo">
          <i class="material-icons watchlist-icon on-watchlist">
            remove_red_eye
          </i>
        </ng-container>
        <ng-template #elseNo>
          <i class="material-icons watchlist-icon">
            remove_red_eye
          </i>
        </ng-template>
      </td>
    </ng-container>

    <!-- Conditions Column -->
    <ng-container matColumnDef="conditions">
      <th mat-header-cell *matHeaderCellDef> Conditions </th>
      <td mat-cell *matCellDef="let element">
        <div fxLayout="row" fxLayoutGap="14px">
          <div *ngFor="let item of element.conditions" class="condition-chip" fxLayout="column" fxflex="33%">
            {{item.name}}
          </div>
        </div>
      </td>
    </ng-container>
    <!-- Hidden Columns===============================================================-->
    <!-- PCP Column -->
    <ng-container matColumnDef="pcP_StaffID">
      <th mat-header-cell *matHeaderCellDef></th>
      <td mat-cell *matCellDef="let element">
        {{element.pcP_StaffID}}
      </td>
    </ng-container>
    <ng-template #tpl let-element>
      <div class="mat-row detail-row" [@detailExpand] style="overflow: hidden">
        <div id="patient-details">
          <div fxLayout="row" class="detail-heading">DEMOGRAPHICS</div>
          <div fxLayout="row" *ngIf="patientDetails">
            <!-- <mat-slide-toggle [(ngModel)]="patientDetails" *ngIf="patientDetails.activeStatus && patientDetails.id === patientDetails.id" [checked]="true">Slide me!</mat-slide-toggle> -->
            <form class="example-form" *ngIf="patientDetails | async;" [formGroup]="form" fxLayout="row">
              <div fxLayout="row" fxLayoutGap="34px">
              <div fxLayout="column">
                <mat-slide-toggle formControlName="activeStatus" [checked]="form.controls.activeStatus">ACTIVE
                </mat-slide-toggle>
              </div>
              <div fxLayout="column">
                <label for="firstname">First Name</label>
                <input id="firstname" formControlName="firstName" />
                <div *ngIf="form.controls.firstName.errors?.required && form.controls.firstName.touched" class="error">
                  *Required
                </div>
              </div>
            </div>
            </form>
    
          </div>
    
        </div>
      </div>
    </ng-template>

    <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
    <tr mat-row *matRowDef="let row; columns: displayedColumns;" class="element-row" [cdkDetailRow]="row"
      [cdkDetailRowTpl]="tpl" (click)="getPatientDetails(row.patientId)"></tr>
  </table>

  <mat-paginator [pageSizeOptions]="[20, 30]" showFirstLastButtons></mat-paginator>
</div>

